{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","self","_negociacoesView","_listaNegociacoes","_mensagemView","_mensagem","_negociacaoServico","_init","listaTodos","setInterval","importaNegociacoes","e","preventDefault","negociacao","_criaNegociacao","adiciona","then","mensagem","texto","_limpaFormulario","catch","console","log","negos","forEach","nego","apagaTodos","esvazia","coluna","ordena","a","b","inverteOrdem","importa","negociacoes","n","erro","textoParaData","value","parseInt","focus","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\nimport {Mensagem} from '../models/Mensagem';\nimport {NegociacoesView} from '../views/NegociacoesView';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {DateHelper} from '../helpers/DateHelper';\nimport {Bind} from '../helpers/Bind';\nimport {Negociacao} from '../models/Negociacao';\n\nclass NegociacaoController{\n\n    constructor(){\n        let $ = document.querySelector.bind(document);\n        this._inputData = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor = $('#valor');\n        this._ordemAtual= '';\n\n        let self = this;\n\n        this._negociacoesView = new NegociacoesView($('#negociacoesView'));   \n        this._listaNegociacoes = new Bind(\n            new ListaNegociacoes(),\n            this._negociacoesView,\n            'adiciona', 'esvazia','ordena','inverteOrdem');\n\n        this._mensagemView = new MensagemView($('#mensagemView'));\n        this._mensagem = new Bind(\n            new Mensagem(), \n            this._mensagemView,\n            'texto');\n\n        this._negociacaoServico = new NegociacaoService();\n\n        this._init();\n    }\n\n    _init(){\n\n        this.listaTodos();\n\n        setInterval(() => this.importaNegociacoes(), 3000);\n\n    }\n\n    adiciona(e){\n\n        e.preventDefault();\n        let negociacao = this._criaNegociacao();\n\n        this._negociacaoServico.adiciona(negociacao)\n        .then((mensagem) =>{\n            this._listaNegociacoes.adiciona(negociacao);\n            this._mensagem.texto = mensagem;\n            this._limpaFormulario();           \n        })\n        .catch(e => this._mensagem.texto = e);\n    }\n\n    listaTodos(){\n\n        console.log('listando...    ');\n\n        this._negociacaoServico.listaTodos()\n        .then((negos) => \n            negos.forEach(nego => \n                this._listaNegociacoes.adiciona(nego))\n        )\n        .catch(e => this._mensagem.texto = e );       \n    }\n\n    apaga(){\n\n        this._negociacaoServico.apagaTodos()\n            .then((mensagem) =>{\n                this._mensagem.texto = mensagem;\n                this._listaNegociacoes.esvazia();\n                this._limpaFormulario();           \n            })\n            .catch(e =>{\n                this._mensagem.texto = e;\n            });        \n    }\n\n    ordena(coluna){\n\n        if(this._ordemAtual == ''|| this._ordemAtual != coluna)\n            this._listaNegociacoes.ordena((a,b) => a[coluna] - b[coluna]);\n        else\n            this._listaNegociacoes.inverteOrdem();\n\n        this._ordemAtual = coluna;\n    }\n\n    importaNegociacoes(){\n\n        this._negociacaoServico.importa(this._listaNegociacoes.negociacoes)\n            .then(negos => {\n                negos.forEach(n => this._listaNegociacoes.adiciona(n) );\n                this._mensagem.texto = 'Negociacoes Importadas com sucesso';\n            })\n            .catch(erro => this._mensagem.texto = erro);\n    }\n\n    _criaNegociacao(){\n        return new Negociacao(\n            DateHelper.textoParaData(this._inputData.value), \n            parseInt( this._inputQuantidade.value), \n            parseInt(this._inputValor.value)\n        );\n    }\n\n    _limpaFormulario(){\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0;\n        this._inputData.focus();       \n    }\n\n}\n\n\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance(){\n    return negociacaoController;\n}"]}